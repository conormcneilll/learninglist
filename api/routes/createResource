const express = require('express');
const router = express.Router();
const connection = require('../connection.js');

// Route to add a resource to a learnlist
router.post('/', (req, res) => {
    const { learnlist_id, title, url, res_type } = req.body;

    if (!learnlist_id || !title || !url || !res_type) {
        return res.status(400).json({ badstuff: 'Missing required fields' });
    }

    const addResourceQuery = `
        INSERT INTO Learnlist_Resource (learnlist_id, resource_id)
        VALUES (?, (SELECT resource_id FROM Resource WHERE title = ? AND url = ? AND res_type = ?))
    `;

    const values = [learnlist_id, title, url, res_type];

    connection.query(addResourceQuery, values, (err, results) => {
        if (err) {
            console.error('Error adding resource to learnlist:', err);
            return res.status(500).json({ badstuff: 'Failed to add resource to learnlist' });
        }

        const resourceId = results.insertId;
        res.json({ goodstuff: { resourceId, learnlist_id } });
    });
});

module.exports = router;
